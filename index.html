<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Delegated Credentials for TLS</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 525px);
    width: 300px;
    z-index: 1;
  }
  #rfc\.toc {
    top: 15px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-right: 350px;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 25px auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Solution Overview">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Rationale">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Related Work">
<link href="#rfc.section.3" rel="Chapter" title="3 Client and Server behavior">
<link href="#rfc.section.4" rel="Chapter" title="4 Delegated Credentials">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Certificate Requirements">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Security of delegated private key">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Revocation of delegated credentials">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Privacy considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.8.2 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Barnes, R., Iyengar, S., Sullivan, N., and E. Rescorla" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-rescorla-tls-subcerts-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-10-28" />
  <meta name="dct.abstract" content="The organizational separation between the operator of a TLS server and the certificate authority that provides it credentials can cause problems, for example when it comes to reducing the lifetime of certificates or supporting new cryptographic algorithms.  This document describes a mechanism to allow TLS server operators to create their own credential delegations without breaking compatibility with clients that do not support this specification." />
  <meta name="description" content="The organizational separation between the operator of a TLS server and the certificate authority that provides it credentials can cause problems, for example when it comes to reducing the lifetime of certificates or supporting new cryptographic algorithms.  This document describes a mechanism to allow TLS server operators to create their own credential delegations without breaking compatibility with clients that do not support this specification." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">R. Barnes</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Mozilla</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">S. Iyengar</td>
</tr>
<tr>
<td class="left">Expires: May 1, 2018</td>
<td class="right">Facebook</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">N. Sullivan</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cloudflare</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">E. Rescorla</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">RTFM, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 28, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Delegated Credentials for TLS<br />
  <span class="filename">draft-rescorla-tls-subcerts-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The organizational separation between the operator of a TLS server and the certificate authority that provides it credentials can cause problems, for example when it comes to reducing the lifetime of certificates or supporting new cryptographic algorithms.  This document describes a mechanism to allow TLS server operators to create their own credential delegations without breaking compatibility with clients that do not support this specification.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 1, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Solution Overview</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Rationale</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Related Work</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Client and Server behavior</a>
</li>
<li>4.   <a href="#rfc.section.4">Delegated Credentials</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Certificate Requirements</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Security of delegated private key</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Revocation of delegated credentials</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Privacy considerations</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<ul><li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Typically, a TLS server uses a certificate provided by some entity other than the operator of the server (a &#8220;Certification Authority&#8221; or CA) <a href="#RFC5246" class="xref">[RFC5246]</a> <a href="#RFC5280" class="xref">[RFC5280]</a>.  This organizational separation makes the TLS server operator dependent on the CA for some aspects of its operations, for example:</p>
<p></p>

<ul>
<li>Whenever the server operator wants to deploy a new certificate, it has to interact with the CA.</li>
<li>The server operator can only use TLS authentication schemes for which the CA will issue credentials.</li>
</ul>
<p id="rfc.section.1.p.3">These dependencies cause problems in practice.  Server operators often want to create short-lived certificates for servers in low-trust zones such as CDNs or remote data centers.  This allows server opertors to limit the exposure of keys in cases that they do not realize a compromise has occurred.  The risk inherent in cross-organizational transactions makes it operationally infeasible to rely on an external CA for such short-lived credentials.  In contast to OCSP stapling, in which an operator could choose to talk to the CA frequently to obtain stapled responses, the risk is lower, because failure to fetch an OCSP stapled response results only in degraded performance, however failure to fetch a potentially large number of short lived certificates would result in the service not being available which creates greater operational risk.</p>
<p id="rfc.section.1.p.4">To remove these dependencies, this document proposes a limited delegation mechanism that allows a TLS server operator to issue its own credentials within the scope of a certificate issued by an external CA.  Because the above problems do not relate to the CAs inherent function of validating possession of names, it is safe to make such delegations as long as they only enable the recipient of the delegation to speak for names that the CA has authorized.  For clarity, we will refer to the certificate issued by the CA as a &#8220;certificate&#8221; and the one issued by the operator as a &#8220;Delegated credential&#8221;.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#solution-overview" id="solution-overview">Solution Overview</a>
</h1>
<p id="rfc.section.2.p.1">A Delegated credential is a digitally signed data structure with the following semantic fields:</p>
<p></p>

<ul>
<li>A validity interval</li>
<li>A public key (with its associated algorithm)</li>
</ul>
<p id="rfc.section.2.p.3">The signature on the credential indicates a delegation from the certificate which is issued to the TLS server operator.  The key pair used to sign a credential is presumed to be one whose public key is contained in an X.509 certificate that associates one or more names to the credential.</p>
<p id="rfc.section.2.p.4">A TLS handshake that uses credentials differs from a normal handshake in a few important ways:</p>
<p></p>

<ul>
<li>The client provides an extension in its ClientHello that indicates support for this mechanism.</li>
<li>The server provides both the certificate chain terminating in its certificate as well as the credential.</li>
<li>The client uses information in the server&#8217;s certificate to verify the signature on the credential and verify that the server is asserting an expected identity.</li>
<li>The client uses the public key in the credential as the server&#8217;s working key for the TLS handshake.</li>
</ul>
<p id="rfc.section.2.p.6">Delegated credentials can be used either in TLS 1.3 or TLS 1.2.  Differences between the use of Delegated credentials in the protocols are explictly stated.</p>
<p id="rfc.section.2.p.7">It was noted in <a href="#XPROT" class="xref">[XPROT]</a> that certificates in use by servers that support outdated protocols such as SSLv2 can be used to forge signatures for certificates that contain the keyEncipherment KeyUsage (<a href="#RFC5280" class="xref">[RFC5280]</a> section 4.2.1.3) In order to prevent this type of cross-protocol attack, we define a new DelegationUsage extension to X.509 which permits use of delegated credentials.  Clients MUST NOT accept delegated credentials associated with certificates without this extension.</p>
<p id="rfc.section.2.p.8">Credentials allow the server to terminate TLS connections on behalf of the certificate owner.  If a credential is stolen, there is no mechanism for revoking it without revoking the certificate itself.  To limit the exposure of a delegation credential compromise, servers MUST NOT issue credentials with a validity period longer than 7 days.  Clients MUST NOT accept credentials with longer validity periods.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#rationale" id="rationale">Rationale</a>
</h1>
<p id="rfc.section.2.1.p.1">Delegated credentials present a better alternative from other delegation mechanisms like proxy certificates <a href="#RFC3820" class="xref">[RFC3820]</a> for several reasons:</p>
<p></p>

<ul>
<li>There is no change needed to certificate validation at the PKI layer.</li>
<li>X.509 semantics are very rich.  This can cause unintended consequences if a service owner creates a proxy cert where the properties differ from the leaf certificate.  Delegated credentials have very restricted semantics which should not conflict with X.509 semantics.</li>
<li>Proxy certificates rely on the certificate path building process to establish a binding between the proxy certificate and the server certificate.  Since the cert path building process is not cryptographically protected, it is possible that a proxy certificate could be bound to another certificate with the same public key, with different X.509 parameters.  Delegated credentials, which rely on a cryptographic binding between the entire certificate and the Delegated credential, cannot.</li>
<li>Delegated credentials allow signed messages to be bound to specific versions of TLS.  This prevents them from being used for other protocols if a service owner allows multiple versions of TLS.</li>
</ul>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#related-work" id="related-work">Related Work</a>
</h1>
<p id="rfc.section.2.2.p.1">Many of the use cases for delegated credentials can also be addressed using purely server-side mechanisms that do not require changes to client behavior (e.g., LURK <a href="#I-D.mglt-lurk-tls-requirements" class="xref">[I-D.mglt-lurk-tls-requirements]</a>).  These mechanisms, however, incur per-transaction latency, since the front-end server has to interact with a back-end server that holds a private key.  The mechanism proposed in this document allows the delegation to be done off-line, with no per-transaction latency.  The figure below compares the message flows for these two mechanisms with TLS 1.3 <a href="#I-D.ietf-tls-tls13" class="xref">[I-D.ietf-tls-tls13]</a>.</p>
<pre>
LURK:

Client            Front-End            Back-End
  |----ClientHello---&gt;|                    |
  |&lt;---ServerHello----|                    |
  |&lt;---Certificate----|                    |
  |                   |&lt;-------LURK-------&gt;|
  |&lt;---CertVerify-----|                    |
  |        ...        |                    |


Delegated credentials:

Client            Front-End            Back-End
  |                   |&lt;---Cred Provision--|
  |----ClientHello---&gt;|                    |
  |&lt;---ServerHello----|                    |
  |&lt;---Certificate----|                    |
  |&lt;---CertVerify-----|                    |
</pre>
<p id="rfc.section.2.2.p.2">These two classes of mechanism can be complementary.  A server could use credentials for clients that support them, while using LURK to support legacy clients.</p>
<p id="rfc.section.2.2.p.3">It is possible to address the short-lived certificate concerns above by automating certificate issuance, e.g., with ACME <a href="#I-D.ietf-acme-acme" class="xref">[I-D.ietf-acme-acme]</a>.  In addition to requiring frequent operationally-critical interactions with an external party, this makes the server operator dependent on the CA&#8217;s willingness to issue certificates with sufficiently short lifetimes.  It also fails to address the issues with algorithm support.  Nonetheless, existing automated issuance APIs like ACME may be useful for provisioning credentials, within an operator network.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#client-and-server-behavior" id="client-and-server-behavior">Client and Server behavior</a>
</h1>
<p id="rfc.section.3.p.1">This document defines the following extension code point.</p>
<pre>
    enum {
      ...
      delegated_credential(TBD),
      (65535)
    } ExtensionType;
</pre>
<p id="rfc.section.3.p.2">A client which supports this document SHALL send an empty &#8220;delegated_credential&#8221; extension in its ClientHello.</p>
<p id="rfc.section.3.p.3">If the extension is present, the server MAY send a DelegatedCredential extension.  If the extension is not present, the server MUST NOT send a credential.  A credential MUST NOT be provided unless a Certificate message is also sent.</p>
<p id="rfc.section.3.p.4">When negotiating TLS 1.3, and using Delegated credentials, the server MUST send the DelegatedCredential as an extension in the CertificateEntry of its end entity certificate.  When negotiating TLS 1.2, the DelegatedCredential MUST be sent as an extension in the ServerHello.</p>
<p id="rfc.section.3.p.5">The DelegatedCredential contains a signature from the public key in the end-entity certificate using a signature algorithm advertised by the client in the &#8220;signature_algorithms&#8221; extension.  Additionally, the credential&#8217;s public key MUST be of a type that enables at least one of the supported signature algorithms.  A Delegated credential MUST NOT be negotiated by the server if its signature is not compatible with any of the supported signature algorithms or the credential&#8217;s public key is not usable with the supported signature algorithms of the client, even if the client advertises support for delegated credentials.</p>
<p id="rfc.section.3.p.6">On receiving a credential and a certificate chain, the client validates the certificate chain and matches the end-entity certificate to the server&#8217;s expected identity following its normal procedures.  It then takes the following additional steps:</p>
<p></p>

<ul>
<li>Verify that the current time is within the validity interval of the credential.</li>
<li>Use the public key in the server&#8217;s end-entity certificate to verify the signature on the credential.</li>
<li>Use the public key in the credential to verify a signature provided in the handshake. That is the CertificateVerify message in TLS 1.3 or ServerKeyExchange in 1.2.</li>
<li>Verify that the certificate has the correct extensions that allow the use of Delegated credentials.</li>
</ul>
<p id="rfc.section.3.p.8">Clients that receive Delegated credentials that are valid for more than 7 days MUST terminate the connection with an &#8220;illegal_parameter&#8221; alert.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#delegated-credentials" id="delegated-credentials">Delegated Credentials</a>
</h1>
<p id="rfc.section.4.p.1">While X.509 forbids end-entity certificates from being used as issuers for other certificates, it is perfectly fine to use them to issue other signed objects as long as the certificate contains the digitalSignature key usage (RFC5280 section 4.2.1.3).  We define a new signed object format that would encode only the semantics that are needed for this application.</p>
<pre>
struct {
  uint32 validTime;
  opaque publicKey&lt;0..2^16-1&gt;;
} DelegatedCredentialParams;

struct {
  DelegatedCredentialParams cred;
  SignatureScheme scheme;
  opaque signature&lt;0..2^16-1&gt;;
} DelegatedCredential;
</pre>
<p></p>

<dl>
<dt>validTime:</dt>
<dd style="margin-left: 8">Relative time in seconds from the beginning of the certificate&#8217;s notBefore value after which the Delegated Credential is no longer valid.</dd>
<dt>publicKey:</dt>
<dd style="margin-left: 8">The Delegated Credential&#8217;s public key which is an encoded SubjectPublicKeyInfo <a href="#RFC5280" class="xref">[RFC5280]</a>.</dd>
<dt>scheme:</dt>
<dd style="margin-left: 8">The Signature algorithm and scheme used to sign the Delegated credential.</dd>
<dt>signature:</dt>
<dd style="margin-left: 8">The signature over the credential with the end-entity certificate&#8217;s public key, using the scheme.</dd>
</dl>
<p id="rfc.section.4.p.3">The DelegatedCredential structure is similar to the CertificateVerify structure in TLS 1.3.  Since the SignatureScheme defined in TLS 1.3, TLS 1.2 clients should translate the scheme into an appropriate group and signature algorithm to perform validation.</p>
<p id="rfc.section.4.p.4">The signature of the DelegatedCredential is computed over the concatenation of:</p>
<p></p>

<ol>
<li>A string that consists of octet 32 (0x20) repeated 64 times.</li>
<li>The context string &#8220;TLS, server delegated credentials&#8221;.</li>
<li>A single 0 byte which serves as the separator</li>
<li>Big endian serialized 2 bytes ProtocolVersion of the negotiated TLS version, defined by TLS.</li>
<li>DER encoded X.509 certificate used to sign the DelegatedCredential.</li>
<li>Big endian serialized 2 byte SignatureScheme scheme.</li>
<li>The DelegatedCredentialParams structure.</li>
</ol>
<p id="rfc.section.4.p.6">This signature has a few desirable properties:</p>
<p></p>

<ul>
<li>It is bound to the certificate that signed it.</li>
<li>It is bound to the protocol version that is negotiated.  This is intended to avoid cross-protocol attacks with signing oracles.</li>
</ul>
<p id="rfc.section.4.p.8">The code changes to create and verify Delegated credentials would be localized to the TLS stack, which has the advantage of avoiding changes to security-critical and often delicate PKI code (though of course moves that complexity to the TLS stack).</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#certificate-requirements" id="certificate-requirements">Certificate Requirements</a>
</h1>
<p id="rfc.section.4.1.p.1">We define a new X.509 extension, DelegationUsage to be used in the certificate when the certificate permits the usage of Delegated Credentials.  When this extension is not present the client MUST not accept a Delegated Credential even if it is negotiated by the server.  When it is present, the client MUST follow the validation procedure.</p>
<p id="rfc.section.4.1.p.2">id-ce-delegationUsage OBJECT IDENTIFIER ::=  { TBD }</p>
<p id="rfc.section.4.1.p.3">DelegationUsage ::= BIT STRING { allowed (0) }</p>
<p id="rfc.section.4.1.p.4">Conforming CAs MUST mark this extension as non-critical.  This would allow the certificate to be used by service owners for clients that do not support certificate delegation as well and not need to obtain two certificates.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#security-of-delegated-private-key" id="security-of-delegated-private-key">Security of delegated private key</a>
</h1>
<p id="rfc.section.6.1.p.1">Delegated credentials limits the exposure of the TLS private key by limiting its validity.  An attacker who compromises the private key of a delegated credential can act as a man in the middle until the delegate credential expires, however they cannot create new delegated credentials. Thus delegated credentials should not be used to send a delegation to an untrusted party, but is meant to be used between parties that have some trust relationship with each other.  The secrecy of the delegated private key is thus important and several access control mechanisms SHOULD be used to protect it such as file system controls, physical security or hardware security modules.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#revocation-of-delegated-credentials" id="revocation-of-delegated-credentials">Revocation of delegated credentials</a>
</h1>
<p id="rfc.section.6.2.p.1">Delegated credentials do not provide any additional form of early revocation. Since it is short lived, the expiry of the delegated credential would revoke the credential.  Revocation of the long term private key that signs the delegated credential also implictly revokes the delegated credential.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#privacy-considerations" id="privacy-considerations">Privacy considerations</a>
</h1>
<p id="rfc.section.6.3.p.1">Delegated credentials can be valid for 7 days and it is much easier for a service to create delegated credential than a certificate signed by a CA. A service could determine the client time and clock skew by creating several delegated credentials with different expiry timestamps and observing whether the client would accept it.  Client time could be unique and thus privacy sensitive clients, such as browsers in incognito mode, who do not trust the service might not want to advertise support for delegated credentials or limit the number of probes that a server can perform.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.7.p.1">Thanks to Kyle Nekritz, Anirudh Ramachandran, Benjamin Kaduk, Kazuho Oku, Daniel Kahn Gillmor for their discussions, ideas, and bugs they&#8217;ve found.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5280">[RFC5280]</b></td>
<td class="top">
<a>Cooper, D.</a>, <a>Santesson, S.</a>, <a>Farrell, S.</a>, <a>Boeyen, S.</a>, <a>Housley, R.</a> and <a>W. Polk</a>, "<a href="https://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 5280, DOI 10.17487/RFC5280, May 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-acme-acme">[I-D.ietf-acme-acme]</b></td>
<td class="top">
<a>Barnes, R.</a>, <a>Hoffman-Andrews, J.</a> and <a>J. Kasten</a>, "<a href="https://tools.ietf.org/html/draft-ietf-acme-acme-07">Automatic Certificate Management Environment (ACME)</a>", Internet-Draft draft-ietf-acme-acme-07, June 2017.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-tls-tls13">[I-D.ietf-tls-tls13]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-21">The Transport Layer Security (TLS) Protocol Version 1.3</a>", Internet-Draft draft-ietf-tls-tls13-21, July 2017.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.mglt-lurk-tls-requirements">[I-D.mglt-lurk-tls-requirements]</b></td>
<td class="top">
<a>Migault, D.</a> and <a>K. Ma</a>, "<a href="https://tools.ietf.org/html/draft-mglt-lurk-tls-requirements-00">Authentication Model and Security Requirements for the TLS/DTLS Content Provider Edge Server Split Use Case</a>", Internet-Draft draft-mglt-lurk-tls-requirements-00, January 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3820">[RFC3820]</b></td>
<td class="top">
<a>Tuecke, S.</a>, <a>Welch, V.</a>, <a>Engert, D.</a>, <a>Pearlman, L.</a> and <a>M. Thompson</a>, "<a href="https://tools.ietf.org/html/rfc3820">Internet X.509 Public Key Infrastructure (PKI) Proxy Certificate Profile</a>", RFC 3820, DOI 10.17487/RFC3820, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="XPROT">[XPROT]</b></td>
<td class="top">
<a>Jager, T.</a>, <a>Schwenk, J.</a> and <a>J. Somorovsky</a>, "<a>On the Security of TLS 1.3 and QUIC Against Weaknesses in PKCS#1 v1.5 Encryption</a>", Proceedings of the 22nd ACM SIGSAC Conference on Computer and Communications Security , 2015.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Richard Barnes</span> 
	  <span class="n hidden">
		<span class="family-name">Barnes</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rlb@ipv.sx">rlb@ipv.sx</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Subodh Iyengar</span> 
	  <span class="n hidden">
		<span class="family-name">Iyengar</span>
	  </span>
	</span>
	<span class="org vcardline">Facebook</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:subodh@fb.com">subodh@fb.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Nick Sullivan</span> 
	  <span class="n hidden">
		<span class="family-name">Sullivan</span>
	  </span>
	</span>
	<span class="org vcardline">Cloudflare</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:nick@cloudflare.com">nick@cloudflare.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Eric Rescorla</span> 
	  <span class="n hidden">
		<span class="family-name">Rescorla</span>
	  </span>
	</span>
	<span class="org vcardline">RTFM, Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ekr@rtfm.com">ekr@rtfm.com</a></span>

  </address>
</div>

</body>
</html>
